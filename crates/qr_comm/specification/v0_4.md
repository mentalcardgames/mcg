QR-STREAM PROTOCOL SPECIFICATION
Version 0.4 – 13-Oct-2025

---
## 0. Unknowns

- Are vector clocks needed?
- Number of concurrent Epochs
- Max size of AP nof finalised

## 1. Purpose (one sentence)
QR-STREAM is a unidirectional, byte-stream protocol that fragments application packets.
Frames are broadcasted and network coded as QR-codes at 20 Hz;
receivers may read at 20, 40 or 60 Hz and reconstruct packets.

## 2. Terminology & conventions

- All multi-byte integers little-endian unless noted.
- “Frame”: the complete payload inside the QR-Code.
- “Fragment”: logical piece of an application packet carried inside one frame.
- “AP”: Application Packet.

## 3. Limits
- Participants: ≤ 2^4
- Fragment size: 1024 B ≤ 2^10 B
- Encoding over GF(2^4)
- Factors per participant for NC: 32
- Bits per participant to index encoding window: 16
- Epoch size: 1074249728 B ≈ 2^30 B
- Reserved size per participant in each epoch: 67140608 B ≈ 2^26 B

## 4. Frame layout

| 0…54 (55 Bytes) | 55…86 (32 Bytes) | 87…342 (256 Bytes) | 343…1367 (1024 Bytes) |
|-----------------|------------------|--------------------|-----------------------|
| Header          | Window Encoding  | Coding Factors     | Fragment              |

### 4.1 Fragment

A fragment is a linear combination over GF(2^4) of all known fragments from the current Epoch.

### 4.2 Header

| Byte | Field                      |
|------|----------------------------|
| 0    | Participant ID             |
| 1    | Is this Frame overflowing? |
| 2    | Epoch ID                   |

The first byte is holding the senders ID.
The second and third byte are holding the size of the players newest AP.
The forth byte is telling if this frame is overflowing.
This means that unused space of other participants has to be flooded with zeros.
The last byte is referring to the current epoch.

### 4.3 Coding Factors

- Logical fragments are encoded over a GF(2^4) Field.
- The Frame has 32 factors dedicated for each participant to holt information for NC.
- In addition, 2 Bytes per participant are included which hold the starting index of the factors.
- For network coding we include factors from GF(2^8) for every fragment in the epoch.

## 5. Epoch layout

The epoch is equally divided between all participants, giving each a sixteenth of it.

### 5.1 Application Package layout

T.B.D.

## 6. Timing

| Side     | Rate            | Notes                    |
|----------|-----------------|--------------------------|
| Sender   | 20 Hz           | One frame per QR update. |
| Receiver | 20 / 40 / 60 Hz | Device-dependent         |

## 7. QR presentation limits

| Version | Modules | ECC | Usable Bytes (after ECC) |
|---------|---------|-----|--------------------------|
| 1       | 21×21   | H   | 7                        |
| 1       | 21×21   | L   | 17                       |
| 26      | 121×121 | L   | 1367                     |
| 26      | 121×121 | M   | 1059                     |
| 40      | 177×177 | H   | 1273                     |
| 40      | 177×177 | L   | 2953                     |


→ QR Codes can store 1367-bytes with Version 26 and L redundancy.

## 8. User interaction

- Sender: shows continuously cycling QR frames.
- Receiver: points camera; UI shows
  - current fragment progress,
  - Min-clock (oldest packet not yet reconstructed),
  - Max-clock (newest packet known to exist).

## 9. State diagram (informal)

Sender:
Idle → Acquire AP → Fragment → Encode → Show each frame for 50 ms.

Receiver:
Scan → Buffer frames → Decode coded groups → Re-assemble AP → Update clocks → Deliver to application.

## 11. Security considerations

#### None.

It is possible for a participant to poison the whole network by transmissing bogus data.
Reading a bogus frame immediately poisons the participant.

---